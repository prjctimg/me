#! /usr/bin/bash

# function to replace whitespace with '_'
_encode() {
    local string="$1"
    # shellcheck disable=SC2019
    # shellcheck disable=SC2018
    echo "${string//[[:space:]]/_}" | tr 'A-Z' 'a-z'

}

# Define the options
topics=("Color in art ğŸ¨" "Free Open Source Software ğŸ«¶" "Rust ğŸ¦€" "TypeShit ğŸ’©" "Shell ğŸš" "Concepts in art ğŸ§‘â€ğŸ¨" "Math in art ğŸ§®" "SVG in art ğŸ”³" "My journalğŸ“”")

# Present the options
PS3="Choose an option: "

# Get current date in YYYY-MM-DD format
date=$(date +%Y-%m-%d)

# Prompt for frontmatter fields
printf "
  ________                               .__  __  .__        __  .__              __      __.__            .___
 /  _____/  ____   ____   ____   __  _  _|__|/  |_|  |__   _/  |_|  |__   ____   /  \    /  \__| ____    __| _/
/   \  ___ /  _ \ /    \_/ __ \  \ \/ \/ /  \   __\  |  \  \   __\  |  \_/ __ \  \   \/\/   /  |/    \  / __ | 
\    \_\  (  <_> )   |  \  ___/   \     /|  ||  | |   Y  \  |  | |   Y  \  ___/   \        /|  |   |  \/ /_/ | 
 \______  /\____/|___|  /\___  >   \/\_/ |__||__| |___|  /  |__| |___|  /\___  >   \__/\  / |__|___|  /\____ | 
        \/            \/     \/                        \/             \/     \/         \/          \/      \/ 

\n\n\n"

subdir=''

read -rp "What's the titleğŸ–‹ ?: " title
read -rp "Summarise this post's content ğŸ“œ:" summary
read -rp "What category(ies) does it belong to ğŸ· (comma-separated): " tags

PS3="What's the topic, $(whoami) ?"
select option in "${topics[@]}"; do
    case $option in
    "Shell ğŸš")
        subdir='langs/shell'
        break
        ;;
    "SVG in art ğŸ”³")
        subdir='art/svg'
        break
        ;;
    "My journalğŸ“”")
        subdir='journal'
        break
        ;;
    "Concepts in art ğŸ§‘â€ğŸ¨")
        subdir='art/concepts'
        break
        ;;
    "Math in art ğŸ§®")
        subdir='art/math'
        break
        ;;
    "Color in art ğŸ¨")
        subdir='art/color/'
        break
        ;;
    "Free Open Source Software ğŸ«¶")
        subdir='foss'
        break
        ;;
    "Rust ğŸ¦€")
        subdir='langs/rust'
        break
        ;;
    "TypeShit ğŸ’©")
        subdir='langs/ts'

        break
        ;;
    *)
        echo "Invalid option"
        ;;
    esac
done

# create filename from the passed in title
filename=$(_encode "$title").md

# Create frontmatter
frontmatter=$(
    cat <<EOF
---
title: $title
date: $date
draft: true
tags: [$tags]
layout: PostSimple
summary: $summary
---
EOF
)

# direct the output to a file at the path stored by $filename
echo "$frontmatter" >/home/"$(whoami)"/me/data/blog/"$subdir"/"$filename"

# track the file and make a commit. This last part is opinionated
git add . && git commit -a -m "Newâœ¨ post draft - $title  ğŸ–‹." &
echo "
__________                       .__           __                                   .__           __                   
\______   \  ____ _______  ______|__|  _______/  |_   ____    ____    ____   ____   |__|  ______ |  | __  ____  ___.__.
 |     ___/_/ __ \\_  __ \/  ___/|  | /  ___/\   __\_/ __ \  /    \ _/ ___\_/ __ \  |  | /  ___/ |  |/ /_/ __ \<   |  |
 |    |    \  ___/ |  | \/\___ \ |  | \___ \  |  |  \  ___/ |   |  \\  \___\  ___/  |  | \___ \  |    < \  ___/ \___  |
 |____|     \___  >|__|  /____  >|__|/____  > |__|   \___  >|___|  / \___  >\___  > |__|/____  > |__|_ \ \___  >/ ____|
                \/            \/          \/             \/      \/      \/     \/           \/       \/     \/ \/     
"
